extends base

block content
  div(class='absolute right-0 z-[100] font-bold text-2xl')= game.began_at.toLocaleTimeString('en-US')
    div(class='text-right p-2')
      form(action=`/removeGame/${game._id}` method='post')
        input(type='image' src='/img/recycle.svg' class='w-12 h-12')
  div(class='bg-white border border-gray-300 text-2xl overflow-auto snap-y flex flex-col' style='max-height:75vh;')
    table(class='table-auto w-full' id='gameTable')
      thead(class='z-30 sticky top-0 bg-blue-300')
        tr
          th(class='text-center mx-0-auto')
            svg(class='h-10 w-10')
              use(href='/img/icons.svg#icon-repeat')
          each element in game.players
            th(class='p-2')
              img(src=`/img/${element.player.image}`, alt=`${element.player.name}` class='h-14 w-14 rounded-full mx-0-auto')
          th(class='text-center mx-0-auto')
            svg(class='h-10 w-10 fill-red-600 mx-0-auto')
              use(href='/img/icons.svg#icon-award')
          th(class='p-2 text-left')
            svg(class='w-10 h-10 mx-0-auto fill-[#F2C83B]')
              use( href='/img/icons.svg#icon-coin')
          th(class='p-2 text-left')
            svg(class='w-10 h-10 mx-0-auto')
              use( href='/img/icons.svg#icon-bomb')
          th(class='p-2 text-left')
            svg(class='w-10 h-10 fill-green-600 mx-0-auto')
              use( href='/img/icons.svg#icon-spring')
          th(class='text-center')
            img(src='/img/landlord2.svg' class='h-10 w-10 mx-0-auto')
      - 
        var springTimes = game.rounds.filter((round) => round.spring).length
        var bombsTimes = game.rounds.filter((round) => round.bombs > 0).length
        var wonTimes = game.rounds.filter((round) => round.won).length
        var colors = {}
        colors[game.players[0].player.name] = 'bg-green-300'
        colors[game.players[1].player.name] = 'bg-yellow-300'
        colors[game.players[2].player.name] = 'bg-red-300' 
        var round = {}
      tbody
        form(id='removeRound' name='removeRound' method='post' action='/removeRound' onsubmit='return validateSelection(\'roundId\');')
          input(type='hidden' form='removeRound' name='roundId' id='roundId' value='')
          input(type='hidden' form='removeRound' name='gameId' value=`${game._id}`)
        form(id='game' name='game' method='post' action=`/play/${game._id}`)
          tr(class='bg-gray-300')
            td
              button(type='submit' class='btn-primary') ✔
            fieldset(class='')
              each element in game.players
                td(class=' text-center py-4 px-2')
                  input(class='form-radio w-10 h-10' type='radio' name='landlord' value=`${element.player._id}` checked)
              td(class='text-center py-4 px-2')
                input(type='checkbox' class='w-10 h-10' name='won' id='won')
              td(class='text-center')
                div(class='text-center flex-col')
                  div
                    button(class=' w-8 h-8' type='button' onclick='incNumber(\'base_score\')') ➕
                  div
                    input(type='text' class='w-10 h-10 font-bold text-xl' name='base_score' id='base_score' value='3' readonly)
                  div
                    button(class=' w-8 h-8' type='button' onclick='decNumber(\'base_score\')') ➖
              td(class='text-center')
                div(class='text-center flex-col')
                  div
                    button(class=' w-8 h-8' type='button' onclick='incNumber(\'bombs\')') ➕
                  div
                    input(type='text' class='w-10 h-10 font-bold text-xl text-red-600' name='bombs' id='bombs' value='0' readonly)
                  div
                    button(class=' w-8 h-8' type='button' onclick='decNumber(\'bombs\')') ➖
              td(class='text-center')
                input(type='checkbox'  class='w-10 h-10' name='spring' id='spring')
              td(class='text-center')
                button(type='submit' class='btn-primary' form='removeRound') ❌
        - if( game.rounds.length > 0 )    
          tr(class='bg-[#F5F5DC]')
            td(class='p-2 text-center font-bold')
              img(src='/img/result.svg' class='h-10 w-10 mx-0-auto')
            each element in game.players 
              td(class='pr-2 text-right font-bold')= element.score
            td(class='text-center font-bold')= wonTimes + '/' + game.rounds.length
            td
            td(class='text-center font-bold')= bombsTimes + '/' + game.rounds.length
            td(class='text-center font-bold')= springTimes + '/' + game.rounds.length
            td(class='text-center font-bold')= game.winner.name
        - for(var index = game.rounds.length - 1; index >= 0; index--)
          - round = game.rounds[index]
            tr(onclick='selectRow(this,\'roundId\')' id=`${round._id}`)
              td(class='p-2 text-center font-bold')= index+1
              each element in game.players
                - 
                  var score = element.player.name === round.landlord.name ? round.landlord_score : round.peasant_score
                  var cstr = score < 0 ? 'text-white font-bold bg-red-600' : ''
                td(class=`pr-2 text-right ${cstr}`)= score
              td(class=' text-center')
                input(type='checkbox' class='w-6 h-6' checked=round.won disabled)
              td(class=' text-center')= round.base_score
                - cstr = round.bombs > 0 ? 'bg-green-600 text-white font-bold' : ''; 
              td(class=`text-center ${cstr}`)= round.bombs
              td(class='text-center')
                input(type='checkbox' class='w-6 h-6' checked=round.spring disabled)
              td(class=`text-center ${colors[round.landlord.name]}`)= round.landlord.name
          //- new round below
        